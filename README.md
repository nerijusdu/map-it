# map-it
Roadmap tool. 
![Run E2E tests](https://github.com/nerijusdu/map-it/workflows/Run%20E2E%20tests/badge.svg?branch=master) 
![Build and test](https://github.com/nerijusdu/map-it/workflows/Build%20and%20test/badge.svg?branch=master)

# New things I tried/learned with this project
- Typescript
- Testing with [supertest](https://github.com/visionmedia/supertest)
- [TypeORM](https://github.com/typeorm/typeorm)
- Sign in/Register with Google
- Google Assistant integration
- Service workers
  - Caching
  - Push notifications
- Github actions
- Docker
- [Cypres](https://www.cypress.io/)

# Run locally
- Have [Docker](https://docs.docker.com/install/) installed
- Add `.env` file with `NODE_ENV=docker-dev` inside
- Run `docker-compose up`

# Test

## API test
- Local DB
  - Install PostgreSQL
  - Create database `map-it-test`
- DB in Docker
  - `docker pull postgres:11`
  - `docker run --name pg-docker-map-it-test -e POSTGRES_DB=map-it-test -p 5432:5432 postgres:11`

- `npm run test-local` or `npm run test-watch`

## Cypress test
- Set `NODE_ENV=e2e-test` in `.env` file
- Run `docker-compose up`
- Run `npm run cypress` (in a separate console window/tab)


# Env variables

Environment variables needed for deployment:

| Variable name | Used in | Example value | Description |
|---------------|---------|---------------|-------------|
| NODE_ENV | Frontend/API | prod | Node environment: prod/development/test/test-local/docker-dev |
| API_HOST | Frontend | https://example.com | URL of API |
| GOOGLE_CLIENT_ID | Frontend | 111111-aaaaa.apps.googleusercontent.com | Client ID of OAuth client used for signing in with google |
| VAPID_KEYS_PUBLIC | Frontend/API | - | Public vapid key generated by web-push |
| VAPID_KEYS_PRIVATE | API | - | Private vapid key generated by web-push |
| GOOGLE_CLIENT_SECRET | API | - | Client secret of OAuth client used for signing in with google |
| GOOGLE_ACTIONS_CLIENT_ID | API | 111111-aaaaa.apps.googleusercontent.com | Client ID used for integration with Google Assistant |
| API_HOST_URL | API | https://example.com | Same as API_HOST (duplicated because of deployment to azure errors) |
| WEB_URL | API | https://example.com | URL pointing to frontend application (used for redirects from callbacks) |
| DB_HOST | API | example.postgres.database.azure.com | Database host URL |
| DB_PASSWORD | API | - | Database password |
| DB_USER | API | mapItAdmin@map-it-db | Database username |
| JWT_SECRET | API | - | Random secret string used to validate tokens |
| LOGS_BLOB_ACCOUNT_NAME | API | - | Blob storage account used to save log files |
| LOGS_BLOB_ACCOUNT_SECRET | API | - | Blob storage account secret for log files |
| LOGS_BLOB_CONTAINER | API | - | Container that log files will be save to |
| LOGS_BLOB_NAME | API | - | Blob name for storing logs |

All variables used in frontend need to be set while building/deploying the application.